<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>System.Json Library</title>
    <link href="../../style/library.css" rel="stylesheet" type="text/css"/>
</head>

<body>
    <h1>System.Json Library</h1>

    <p>
        The <a href="System.Json.html">System.Json</a> library provides basic support for exporting and importing <a href="http://www.json.org/">JSON</a>.
        The library and the compiler supports exporting JSON by converting application objects to JSON library objects and then serialization them to JSON text.
        Importing JSON consists of parsing JSON text to back to JSON library objects and then constructing application objects from them.
    </p>

    <h2>
        Exporting JSON
    </h2>

    <p>
        A class that has a <b>json</b> <a href="../../langref/langref.html#attributes">attribute</a> with a value "true" or with no attribute value, can be converted
        to a <a href="System.Json.html#class_JsonObject_1ACA524ABF05C4E15B709275F66F3BF5C165B69D">JsonObject</a> that can further be converted to
        a UTF-8 encoded JSON text by calling the <a href="System.Json.html#member_function_ToString_JsonValue_0E8D02CC91EA26B2A9A8AF1C11DF12FD5FE86F31">ToString()</a> member function of the
        <a href="System.Json.html#class_JsonValue_B86942C2856CC5758E1FB19BBBE97E4002D4008A">JsonValue</a> class.
        Here's an example of such a <a href="../../code/json/exportable/jsonExportable.cm.html">JSON exportable class</a>.
        The program writes the JSON text {"b":false, "d":0, "i":0, "s":""} to the standard output stream.
    </p>

    <p>
        For each class having the <b>json</b> attribute equal to "true" or with no attribute value, 
        the compiler generates a virtual member function named <b>ToJson</b> that returns a unique pointer to a <a href="System.Json.html#class_JsonValue_B86942C2856CC5758E1FB19BBBE97E4002D4008A">JsonValue</a>.
        The <em>JsonValue</em> pointer points in fact to an instance of a <a href="System.Json.html#class_JsonObject_1ACA524ABF05C4E15B709275F66F3BF5C165B69D">JsonObject</a>. 
        Each member variable that either has no <b>json</b> attribute, or has a <b>json</b> attribute with value "true" or with no attribute value, will be serialized by adding it to the generated <em>JsonObject</em>
        by calling the <a href="System.Json.html#function_group_AddField_9C28B5737E68F5B7F6EFF0734E146A93E593F379">AddField</a> member function.
        The field name of the member variable in the serialized JSON object will have value equal to a <b>jsonFieldName</b> attribute of the member variable, if given,
        or equal to the name of the member variable, if the member variable has no <b>jsonFieldName</b> attribute.
    </p>

    <p>
        The library supports the serialization of the following data types:
        <ul>
            <li>
                <a href="../System.Base/System.Base.html#typedef_string_B6DB6B2DEFC437FBF697A2E84F7B7771FC1DDEE3">string</a>
                <a href="../System.Base/System.Base.html#typedef_wstring_EDB6336488DF46A7779AFB4209BAB1DAF59B5DAE">wstring</a> and
                <a href="../System.Base/System.Base.html#typedef_ustring_1750E1C62AAF5897C1F1DA3C5BC4999982AE9B36">ustring</a> are
                converted to <a href="System.Json.html#class_JsonString_5806452F49D8C71DEDC42FCEB48EC3A2163F7516">JSON strings</a>.
            </li>
            <li>
                <b>bool</b> is converted to a <a href="System.Json.html#class_JsonBool_DECA0A9F59CE58DA61371982ADCFCD31F1497F79">JSON bool</a>.
            </li>
            <li>
                Numeric values that are implicitly convertible to a <b>double</b>, such as <b>int</b>, <b>float</b> and <b>double</b> are converted to a
                <a href="System.Json.html#class_JsonNumber_BA94887A1742701B420D069040E7953026161429">JSON number</a>.
            </li>
            <li>
                <a href="../System.Base/System.Base.html#class_Map_Key_Value_KeyCompare_530B43B96CDA5DBA8045A4DA0691BBB50DE2DB3D">Maps</a> and
                <a href="../System.Base/System.Base.html#class_HashMap_K_T_H_C_925D53DF947742545E7EC07D3487F3EA8C8D1D36">HashMaps</a> with string keys are converted to a
                <a href="System.Json.html#class_JsonObject_1ACA524ABF05C4E15B709275F66F3BF5C165B69D">JSON objects</a> with the keys as field names and the mapped types as field values.
            </li>
            <li>
                <a href="../System.Base/System.Base.html#class_List_T_579A89BF19B54042190CDE2A7E54E1DFAAFDB31C">Lists</a> are converted to
                <a href="System.Json.html#class_JsonArray_595A35C98AB243A92CA1C39BB1B07E82AA246D18">JSON arrays</a> with list elements as array items.
            </li>
            <li>
                A <a href="../System.Json/System.Json.html#concept_JsonExportable_380A04F1C16289D6FC8DB54C68F467C83E565340">JSON exportable</a> class is converted
                by calling its virtual <b>ToJson</b> member function.
            </li>
            <li>
                A null (empty) <a href="../System.Base/System.Base.html#class_UniquePtr_T_793F841C13E9DD3A6869243C74F1D948C0E04009">unique pointer</a> or a
                <a href="../System.Base/System.Base.html#class_SharedPtr_T_E2198BEF58335A9A782FD48D7E8DFFD1A2D8865F">shared pointer</a> 
                will be converted to a <a href="System.Json.html#class_JsonNull_E0746AE6880508740D5FFC8AF4E0FB0A7AE20ED2">JSON null</a>.
            </li>
            <li>
                A non-null <a href="../System.Base/System.Base.html#class_UniquePtr_T_793F841C13E9DD3A6869243C74F1D948C0E04009">unique pointer</a> or a
                <a href="../System.Base/System.Base.html#class_SharedPtr_T_E2198BEF58335A9A782FD48D7E8DFFD1A2D8865F">shared pointer</a> of a 
                <a href="../System.Json/System.Json.html#concept_JsonExportable_380A04F1C16289D6FC8DB54C68F467C83E565340">JSON exportable</a> class is serialized
                to a JSON object with two fields: a field named <b>class</b> will contain the dynamic type name of the JSON exportable class and a field named <b>object</b>
                will have a value generated by calling the virtual <b>ToJson</b> member function of the JSON exportable class.
            </li>
        </ul>
    </p>

    <p>
        If a <a href="../System.Json/System.Json.html#concept_JsonExportable_380A04F1C16289D6FC8DB54C68F467C83E565340">JSON exportable</a> class derives from a class that has no
        <b>json</b> attribute, that base class will not be serialized, and the compiler will give of warning.
        If a base class has a <b>json</b> attribute that is equal to "false", the base class will not be serialized, and no warning is given.
        If a base class has a <b>json</b> attribute that is equal to "true" or with no attribute value, the compiler serializes the base class inside of the top level JSON object.
        In this case the JSON field names must be unique among the top level class and its base class and ancestor classes.
        The JSON field name of a member variable can be changed by giving it a <b>jsonFieldName</b> attribute with a non-empty value.
    </p>

    <h2>Importing JSON</h2>

    <p>
        A class that has a <b>json</b> <a href="../../langref/langref.html#attributes">attribute</a> with a value "true" or with no attribute value, can import JSON.
        For each such a class the compiler generates two member functions:
        <ul>
            <li>a <b>constructor</b> taking a pointer to a <a href="System.Json.html#class_JsonValue_B86942C2856CC5758E1FB19BBBE97E4002D4008A">JsonValue</a> class, and</li>
            <li>a static <b>Create</b> member function that calls the constructor.</li>
        </ul>
        The constructor contains calls to <a href="System.Json.html#function_group_FromJson_22997B691ACDD99EB254F19DD18F75F989FE89EF">FromJson</a> function for each member variable that 
        either has no <b>json</b> attribute, or has a <b>json</b> attribute with value equal to "true" or with no attribute value.
    </p>

    <p>
        Importing JSON consists of parsing a JSON text by calling the <a href="System.Json.html#function_group_ParseJson_D0F1BA19044FC5C9F02861FE13E01F68658D55A5">ParseJson</a> function 
        with UTF-8, UTF-16 or UTF-32 encoded string and passing the returned <a href="System.Json.html#class_JsonValue_B86942C2856CC5758E1FB19BBBE97E4002D4008A">JsonValue</a> 
        to the application class constructor. Here's an example of such a <a href="../../code/json/constructible/jsonConstructible.cm.html">JSON constructible class</a>.
        The program writes lines 
        <blockquote>
            <pre>
                i : 2
                d : 1.5
                b : true
                s : foo
            </pre>
        </blockquote>
        to the standard output stream.
    </p>

    <p>
        The following data types can be imported:

        <ul>
            <li>
                A <a href="System.Json.html#class_JsonString_5806452F49D8C71DEDC42FCEB48EC3A2163F7516">JSON string</a> can be imported to a
                <a href="../System.Base/System.Base.html#typedef_string_B6DB6B2DEFC437FBF697A2E84F7B7771FC1DDEE3">string</a>
                <a href="../System.Base/System.Base.html#typedef_wstring_EDB6336488DF46A7779AFB4209BAB1DAF59B5DAE">wstring</a> or
                <a href="../System.Base/System.Base.html#typedef_ustring_1750E1C62AAF5897C1F1DA3C5BC4999982AE9B36">ustring</a> type variable.
            </li>
            <li>
                A <a href="System.Json.html#class_JsonBool_DECA0A9F59CE58DA61371982ADCFCD31F1497F79">JSON bool</a> can be imported to a <b>bool</b> type variable.
            </li>
            <li>
                A <a href="System.Json.html#class_JsonNumber_BA94887A1742701B420D069040E7953026161429">JSON number</a> can be imported to <b>int</b> or <b>double</b> type variable.
            </li>
            <li>
                A <a href="System.Json.html#class_JsonObject_1ACA524ABF05C4E15B709275F66F3BF5C165B69D">JSON object</a> can be imported to a
                <a href="../System.Base/System.Base.html#class_Map_Key_Value_KeyCompare_530B43B96CDA5DBA8045A4DA0691BBB50DE2DB3D">map</a> or 
                <a href="../System.Base/System.Base.html#class_HashMap_K_T_H_C_925D53DF947742545E7EC07D3487F3EA8C8D1D36">hash map</a> member variable with 
                <a href="../System.Base/System.Base.html#typedef_string_B6DB6B2DEFC437FBF697A2E84F7B7771FC1DDEE3">string</a>,
                <a href="../System.Base/System.Base.html#typedef_wstring_EDB6336488DF46A7779AFB4209BAB1DAF59B5DAE">wstring</a> or 
                <a href="../System.Base/System.Base.html#typedef_ustring_1750E1C62AAF5897C1F1DA3C5BC4999982AE9B36">ustring</a> type keys,
                or to a <a href="System.Json.html#concept_JsonConstructible_FDF8EB5A6050ED39397E14EF89FACCA63F29DDF2">JSON constructible</a> class member variable.
            </li>
            <li>
                A <a href="System.Json.html#class_JsonArray_595A35C98AB243A92CA1C39BB1B07E82AA246D18">JSON array</a> can be imported to a 
                <a href="../System.Base/System.Base.html#class_List_T_579A89BF19B54042190CDE2A7E54E1DFAAFDB31C">list</a> type member variable.
            </li>
            <li>
                <a href="System.Json.html#class_JsonNull_E0746AE6880508740D5FFC8AF4E0FB0A7AE20ED2">JSON null</a> can be imported to a
                <a href="../System.Base/System.Base.html#class_UniquePtr_T_793F841C13E9DD3A6869243C74F1D948C0E04009">unique pointer</a> or to a
                <a href="../System.Base/System.Base.html#class_SharedPtr_T_E2198BEF58335A9A782FD48D7E8DFFD1A2D8865F">shared pointer</a>.
            </li>
            <li>
                A <a href="System.Json.html#class_JsonObject_1ACA524ABF05C4E15B709275F66F3BF5C165B69D">JSON object</a> with field names <b>class</b> and <b>object</b>
                can be imported to <a href="../System.Base/System.Base.html#class_UniquePtr_T_793F841C13E9DD3A6869243C74F1D948C0E04009">unique pointer</a> or to a
                <a href="../System.Base/System.Base.html#class_SharedPtr_T_E2198BEF58335A9A782FD48D7E8DFFD1A2D8865F">shared pointer</a> to a
                <a href="System.Json.html#concept_JsonConstructible_FDF8EB5A6050ED39397E14EF89FACCA63F29DDF2">JSON constructible</a> class.
                In this case the JSON object is deserialized by first reading the dynamic class name from the <b>class</b> field, then
                reading a JSON value by reading the <b>object</b> field of the JSON object, and finally 
                creating an instance of that class by calling the <a href="System.Json.html#class_JsonClassFactory_07F3FE1559307E1B17EEBEAFBAA8C9DBAA71924E">JsonClassFactory</a>
                with the class name and JSON value.
            </li>
        </ul>
    </p>

    <h2>
        Vehicles
    </h2>

    <p>
        <a href="../../code/json/vehicles/vehicles.cm.html">Vehicles</a> is an example of polymorphic classes that are serialized to and parsed from JSON.
    </p>

    <p>
        The program generates the following output:
        <blockquote>
            <pre>
Vehicles.Car:
speed: 200
model: Porsche
registrationNumber: ABC-123
{"class":"Vehicles.Car", "object":{"model":"Porsche", "registrationNumber":"ABC-123", "speed":200}}
Vehicles.Car:
speed: 200
model: Porsche
registrationNumber: ABC-123
Vehicles.Truck:
speed: 100
model: Volvo
registrationNumber: XYZ-987
weight: 1000
Vehicles.Car:
speed: 150
model: Peugeot
registrationNumber: PRQ-567
Vehicles.Bicycle:
speed: 30
brand: Pegoretti
[{"class":"Vehicles.Truck", "object":{"model":"Volvo", "registrationNumber":"XYZ-987", "speed":100, "weight":1000}}, {"class":"Vehicles.Car", "object":{"model":"Peugeot", "registrationNumber":"PRQ-567", "speed":150}}, {"class":"Vehicles.Bicycle", "object":{"brand":"Pegoretti", "speed":30}}]
Vehicles.Truck:
speed: 100
model: Volvo
registrationNumber: XYZ-987
weight: 1000
Vehicles.Car:
speed: 150
model: Peugeot
registrationNumber: PRQ-567
Vehicles.Bicycle:
speed: 30
brand: Pegoretti
            </pre>
        </blockquote>
    </p>

    <h2>
        Example
    </h2>

    <p>
        Here's another <a href="../../code/json/all/json.cm.html">example</a> of classes that support exporting and importing JSON.
    </p>

    <p>
        The program generates the following output:
        <blockquote>
            <pre>
beta:
b : false
s : xyzzy
alpha:
i : 1
d : 2
b : true
s : foo
w : bar
u : öhkömömmö
l : 3
    1
    2
    3
m : 2
    abc : 4
    def : 5
h : 1
    xyz : 6.5
member : x = 0
memberList : 2
    member : x = 1
    member : x = 2
    member : x = 10
    derived member : d = 3.140000000000000
alpha as JSON:
{"b":true, "beta.s":"xyzzy", "d":2, "h":{"xyz":6.5}, "i":1, "l":[1, 2, 3], "m":{"abc":4, "def":5}, "member":{"x":0}, "memberList":[{"x":1}, {"x":2}], "memberPtr":{"class":"DerivedMember", "object":{"d":3.140000000000000, "x":10}}, "s":"foo", "u":"\u00F6hk\u00F6m\u00F6mm\u00F6", "w":"bar"}
beta:
b : false
s : xyzzy
alpha:
i : 1
d : 2
b : true
s : foo
w : bar
u : öhkömömmö
l : 3
    1
    2
    3
m : 2
    abc : 4
    def : 5
h : 1
    xyz : 6.5
member : x = 0
memberList : 2
    member : x = 1
    member : x = 2
    member : x = 10
    derived member : d = 3.140000000000000
            </pre>
        </blockquote>

    </p>
</body>
</html>